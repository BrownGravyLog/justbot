<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Justbot::Plugins::RegistrationManager
  
    &mdash; Documentation by YARD 0.8.7
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Justbot.html" title="Justbot (module)">Justbot</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Plugins.html" title="Justbot::Plugins (module)">Plugins</a></span></span>
     &raquo; 
    <span class="title">RegistrationManager</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Justbot::Plugins::RegistrationManager
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Justbot::Plugins::RegistrationManager</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">Cinch::Plugin, <span class='object_link'><a href="../Helpful.html" title="Justbot::Helpful (module)">Helpful</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/plugins/registration_manager.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'>
<p>allow users to register without OAuthing with twitter like if they want to
use the bot for the other functions maybe</p>
</div>
  </div>


<p>register new users and oauth their twitter creds</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="RegistrationManager/RegStatus.html" title="Justbot::Plugins::RegistrationManager::RegStatus (module)">RegStatus</a></span>
    
  
    
  
</p>







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (RegistrationManager) <strong>initialize</strong>(*args) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of RegistrationManager.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_complete-instance_method" title="#register_complete (instance method)">- (Object) <strong>register_complete</strong>(m, password) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>complete the registration, encrypting and saving user data as a new User.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_oauth_pin-instance_method" title="#register_oauth_pin (instance method)">- (Object) <strong>register_oauth_pin</strong>(m, pin) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>complete the oauth step by handing the app a oauth verifier in the form of
a PIN.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#register_start-instance_method" title="#register_start (instance method)">- (Object) <strong>register_start</strong>(m) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>begin the registration process.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Helpful.html" title="Justbot::Helpful (module)">Helpful</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Helpful.html#Session-instance_method" title="Justbot::Helpful#Session (method)">#Session</a></span>, <span class='object_link'><a href="../Helpful.html#if_admin-instance_method" title="Justbot::Helpful#if_admin (method)">#if_admin</a></span>, <span class='object_link'><a href="../Helpful.html#notify_private_reply-instance_method" title="Justbot::Helpful#notify_private_reply (method)">#notify_private_reply</a></span>, <span class='object_link'><a href="../Helpful.html#reply_in_pm-instance_method" title="Justbot::Helpful#reply_in_pm (method)">#reply_in_pm</a></span></p>

  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Justbot::Plugins::RegistrationManager (class)">RegistrationManager</a></span></tt>) <strong>initialize</strong>(*args) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of RegistrationManager</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27
28
29
30
31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plugins/registration_manager.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span> <span class='op'>*</span><span class='id identifier rubyid_args'>args</span>
  <span class='kw'>super</span>

  <span class='ivar'>@pending_registrations</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@app_oauth</span> <span class='op'>=</span> <span class='const'>YAML</span><span class='period'>.</span><span class='id identifier rubyid_load_file'>load_file</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Justbot</span><span class='op'>::</span><span class='const'>CONFIG_ROOT</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>twitter.yaml</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>oauth</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@app_token</span> <span class='op'>=</span> <span class='ivar'>@app_oauth</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='ivar'>@app_oauth</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:oauth_token</span><span class='rparen'>)</span>
  <span class='ivar'>@app_oauth</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:oauth_token_secret</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="register_complete-instance_method">
  
    - (<tt>Object</tt>) <strong>register_complete</strong>(m, password) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>complete the registration, encrypting and saving user data as a new User</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plugins/registration_manager.rb', line 113</span>

<span class='kw'>def</span> <span class='id identifier rubyid_register_complete'>register_complete</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_user_reg_status'>user_reg_status</span> <span class='op'>=</span> <span class='id identifier rubyid_registration_guard'>registration_guard</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lbracket'>[</span><span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>NICK_TAKEN</span><span class='comma'>,</span> <span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>LOGGED_IN</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_user_reg_status'>user_reg_status</span>
    <span class='comment'># they&#39;ve already recieved a message re: their status, so just abort
</span>    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='comment'># registrations must start at #register_start
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_user_reg_status'>user_reg_status</span> <span class='op'>==</span> <span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>NEW_REGISTRATION</span>
    <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_reply'>reply</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please begin the registration process by PMing &#39;register start&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='comment'># some people still need to enter pins
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_user_reg_status'>user_reg_status</span> <span class='op'>==</span> <span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>AWAITING_OAUTH</span>
    <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_reply'>reply</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must oauth before you can complete registration.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_reply'>reply</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>If you can&#39;t find your oauth URL, just start the registration process over with &#39;register begin&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_reg'>reg</span> <span class='op'>=</span> <span class='ivar'>@pending_registrations</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='rparen'>)</span>
  <span class='comment'># sweet lets encrypt some stuff
</span>
  <span class='id identifier rubyid_c_token'>c_token</span> <span class='op'>=</span>  <span class='const'>Crypto</span><span class='period'>.</span><span class='id identifier rubyid_crypt'>crypt</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='lbracket'>[</span><span class='symbol'>:access</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_c_secret'>c_secret</span> <span class='op'>=</span> <span class='const'>Crypto</span><span class='period'>.</span><span class='id identifier rubyid_crypt'>crypt</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='lbracket'>[</span><span class='symbol'>:access</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_secret'>secret</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='rparen'>)</span>

  <span class='comment'># WOO NEW USER WITH OAUTH STUFF
</span>  <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span>
      <span class='symbol'>:name</span> <span class='op'>=&gt;</span>                    <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_nick'>nick</span><span class='comma'>,</span>
      <span class='symbol'>:password</span> <span class='op'>=&gt;</span>                <span class='const'>Crypto</span><span class='period'>.</span><span class='id identifier rubyid_digest'>digest</span><span class='lparen'>(</span><span class='id identifier rubyid_password'>password</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='symbol'>:twitter_id</span> <span class='op'>=&gt;</span>              <span class='id identifier rubyid_reg'>reg</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='symbol'>:crypted_twitter_token</span> <span class='op'>=&gt;</span>   <span class='id identifier rubyid_c_token'>c_token</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span>
      <span class='symbol'>:crypted_twitter_secret</span> <span class='op'>=&gt;</span>  <span class='id identifier rubyid_c_secret'>c_secret</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span><span class='comma'>,</span>
      <span class='symbol'>:iv_twitter_token</span> <span class='op'>=&gt;</span>        <span class='id identifier rubyid_c_token'>c_token</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span><span class='comma'>,</span>
      <span class='symbol'>:iv_twitter_secret</span> <span class='op'>=&gt;</span>       <span class='id identifier rubyid_c_secret'>c_secret</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_rescue_exception'>rescue_exception</span> <span class='kw'>do</span>
    <span class='comment'># and.... follow them on twitter!
</span>    <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Twitter</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@app_token</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_follow'>follow</span><span class='lparen'>(</span><span class='id identifier rubyid_reg'>reg</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_reply'>reply</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user %s created successfully!</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='const'>Format</span><span class='lparen'>(</span><span class='symbol'>:bold</span><span class='comma'>,</span> <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_nick'>nick</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_oauth_pin-instance_method">
  
    - (<tt>Object</tt>) <strong>register_oauth_pin</strong>(m, pin) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>complete the oauth step by handing the app a oauth verifier in the form of
a PIN</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plugins/registration_manager.rb', line 78</span>

<span class='kw'>def</span> <span class='id identifier rubyid_register_oauth_pin'>register_oauth_pin</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='id identifier rubyid_pin'>pin</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_user_reg_status'>user_reg_status</span> <span class='op'>=</span> <span class='id identifier rubyid_registration_guard'>registration_guard</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lbracket'>[</span><span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>NICK_TAKEN</span><span class='comma'>,</span> <span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>LOGGED_IN</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_user_reg_status'>user_reg_status</span>
    <span class='comment'># they&#39;ve already recieved a message re: their status, so just abort
</span>    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='comment'># registrations must start at #register_start
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_user_reg_status'>user_reg_status</span> <span class='op'>==</span> <span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>NEW_REGISTRATION</span>
    <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_reply'>reply</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please begin the registration process by PMing &#39;register start&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='comment'># people who have oauthed already don&#39;t need to derp PINs again
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_user_reg_status'>user_reg_status</span> <span class='op'>==</span> <span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>OAUTH_COMPLETE</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='comment'># do oauth stuff: generate authorization token
</span>  <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='ivar'>@pending_registrations</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:client</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='ivar'>@pending_registrations</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:request_token</span><span class='rbracket'>]</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@pending_registrations</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:access</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_authorize'>authorize</span><span class='lparen'>(</span>
        <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span><span class='comma'>,</span>
        <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_secret'>secret</span><span class='comma'>,</span>
        <span class='symbol'>:oauth_verifier</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pin'>pin</span>
    <span class='rparen'>)</span>
    <span class='id identifier rubyid_help_complete_registration'>help_complete_registration</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span>
    <span class='comment'># todo: handle all the crazy errors this throws
</span>  <span class='kw'>rescue</span> <span class='const'>OAuth</span><span class='op'>::</span><span class='const'>Unauthorized</span>
    <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_reply'>reply</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I was unable to authorize you. Please check your PIN and try again.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="register_start-instance_method">
  
    - (<tt>Object</tt>) <strong>register_start</strong>(m) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>begin the registration process</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/plugins/registration_manager.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_register_start'>register_start</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_user_reg_status'>user_reg_status</span> <span class='op'>=</span> <span class='id identifier rubyid_registration_guard'>registration_guard</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lbracket'>[</span><span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>NICK_TAKEN</span><span class='comma'>,</span> <span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>LOGGED_IN</span><span class='comma'>,</span> <span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>OAUTH_COMPLETE</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_user_reg_status'>user_reg_status</span>
    <span class='comment'># they&#39;ve already recieved a message re: their status, so just abort
</span>    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_user_reg_status'>user_reg_status</span> <span class='op'>==</span> <span class='const'>RegStatus</span><span class='op'>::</span><span class='const'>AWAITING_OAUTH</span>
    <span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_reply'>reply</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Restarting your registration.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># notify continuing via PM
</span>  <span class='const'>Justbot</span><span class='period'>.</span><span class='id identifier rubyid_notify_private_reply'>notify_private_reply</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>registration</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='const'>Justbot</span><span class='period'>.</span><span class='id identifier rubyid_reply_in_pm'>reply_in_pm</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>To register you must authenticate via Twitter. Starting OAuth session...</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='comment'># do oauth stuff: generate request token
</span>  <span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='const'>TwitterOAuth</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@app_oauth</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_request_token'>request_token</span><span class='lparen'>(</span><span class='symbol'>:oauth_callback</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>oob</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@pending_registrations</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_mask'>mask</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='symbol'>:client</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_client'>client</span><span class='comma'>,</span>
      <span class='symbol'>:request_token</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_req'>req</span>
  <span class='rbrace'>}</span>
  <span class='const'>Justbot</span><span class='period'>.</span><span class='id identifier rubyid_reply_in_pm'>reply_in_pm</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
    <span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>go to %s to auth with twitter</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='const'>Format</span><span class='lparen'>(</span><span class='symbol'>:bold</span><span class='comma'>,</span> <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_authorize_url'>authorize_url</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>then oauth with this bot using </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='const'>Format</span><span class='lparen'>(</span><span class='symbol'>:bold</span><span class='comma'>,</span> <span class='const'>Format</span><span class='lparen'>(</span><span class='symbol'>:blue</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>register oauth</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_r'>r</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>type &#39;register oauth YOUR_PIN_NUMBER&#39;</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu Aug  8 19:36:14 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7 (ruby-2.0.0).
</div>

  </body>
</html>